{"version":3,"file":"index.fb997330.js","sources":["../../src/layout/components/Search/index.vue"],"sourcesContent":["<script setup name=\"Search\">\r\nimport { deepClone, isExternalLink } from '@/util'\r\n\r\nconst { proxy } = getCurrentInstance()\r\n\r\nimport useSettingsStore from '@/store/modules/settings'\r\nconst settingsStore = useSettingsStore()\r\nimport useRouteStore from '@/store/modules/route'\r\nconst routeStore = useRouteStore()\r\nimport useMenuStore from '@/store/modules/menu'\r\nconst menuStore = useMenuStore()\r\n\r\nconst isShow = ref(false)\r\nconst searchInput = ref('')\r\nconst sourceList = ref([])\r\nconst actived = ref(-1)\r\n\r\nconst resultList = computed(() => {\r\n    let result = []\r\n    result = sourceList.value.filter(item => {\r\n        let flag = false\r\n        if (item.title.indexOf(searchInput.value) >= 0) {\r\n            flag = true\r\n        }\r\n        if (item.path.indexOf(searchInput.value) >= 0) {\r\n            flag = true\r\n        }\r\n        if (item.breadcrumb.some(b => b.indexOf(searchInput.value) >= 0)) {\r\n            flag = true\r\n        }\r\n        return flag\r\n    })\r\n    return result\r\n})\r\n\r\nwatch(() => isShow.value, val => {\r\n    if (val) {\r\n        document.querySelector('body').classList.add('hidden')\r\n        proxy.$refs.search.scrollTop = 0\r\n        // 当搜索显示的时候绑定上、下、回车快捷键，隐藏的时候再解绑。另外当 input 处于 focus 状态时，采用 vue 来绑定键盘事件\r\n        proxy.$hotkeys('up', keyUp)\r\n        proxy.$hotkeys('down', keyDown)\r\n        proxy.$hotkeys('enter', keyEnter)\r\n        setTimeout(() => {\r\n            proxy.$refs.input.focus()\r\n        }, 500)\r\n    } else {\r\n        document.querySelector('body').classList.remove('hidden')\r\n        proxy.$hotkeys.unbind('up', keyUp)\r\n        proxy.$hotkeys.unbind('down', keyDown)\r\n        proxy.$hotkeys.unbind('enter', keyEnter)\r\n        setTimeout(() => {\r\n            searchInput.value = ''\r\n            actived.value = -1\r\n        }, 500)\r\n    }\r\n})\r\nwatch(() => resultList.value, () => {\r\n    actived.value = -1\r\n    handleScroll()\r\n})\r\n\r\nonMounted(() => {\r\n    proxy.$eventBus.on('global-search-toggle', () => {\r\n        isShow.value = !isShow.value\r\n    })\r\n    proxy.$hotkeys('alt+s', e => {\r\n        if (settingsStore.topbar.enableNavSearch) {\r\n            e.preventDefault()\r\n            isShow.value = true\r\n        }\r\n    })\r\n    proxy.$hotkeys('esc', e => {\r\n        if (settingsStore.topbar.enableNavSearch) {\r\n            e.preventDefault()\r\n            isShow.value = false\r\n        }\r\n    })\r\n    if (settingsStore.app.routeBaseOn !== 'filesystem') {\r\n        routeStore.routes.map(item => {\r\n            getSourceList(item.children)\r\n        })\r\n    } else {\r\n        menuStore.menus.map(item => {\r\n            getSourceList(item.children)\r\n        })\r\n    }\r\n})\r\n\r\nfunction hasChildren(item) {\r\n    let flag = true\r\n    if (item.children) {\r\n        if (item.children.every(i => i.meta.sidebar === false)) {\r\n            flag = false\r\n        }\r\n    } else {\r\n        flag = false\r\n    }\r\n    return flag\r\n}\r\nfunction getSourceList(arr) {\r\n    arr.map(item => {\r\n        if (item.meta.sidebar !== false) {\r\n            if (hasChildren(item)) {\r\n                let baseBreadcrumb = item.meta.baseBreadcrumb ? deepClone(item.meta.baseBreadcrumb) : []\r\n                baseBreadcrumb.push(item.meta.title)\r\n                let child = deepClone(item.children)\r\n                child.map(c => {\r\n                    c.meta.baseIcon = item.meta.icon || item.meta.baseIcon\r\n                    c.meta.baseBreadcrumb = baseBreadcrumb\r\n                    c.meta.basePath = item.meta.basePath ? [item.meta.basePath, item.path].join('/') : item.path\r\n                })\r\n                getSourceList(child)\r\n            } else {\r\n                let breadcrumb = []\r\n                if (item.meta.baseBreadcrumb) {\r\n                    breadcrumb = deepClone(item.meta.baseBreadcrumb)\r\n                }\r\n                breadcrumb.push(item.meta.title)\r\n                let path = ''\r\n                if (isExternalLink(item.path)) {\r\n                    path = item.path\r\n                } else {\r\n                    path = item.meta.basePath ? [item.meta.basePath, item.path].join('/') : item.path\r\n                }\r\n                sourceList.value.push({\r\n                    icon: item.meta.icon || item.meta.baseIcon,\r\n                    title: item.meta.title,\r\n                    i18n: item.meta.i18n,\r\n                    breadcrumb: breadcrumb,\r\n                    path: path\r\n                })\r\n            }\r\n        }\r\n    })\r\n}\r\nfunction keyUp() {\r\n    if (resultList.value.length) {\r\n        actived.value -= 1\r\n        if (actived.value < 0) {\r\n            actived.value = resultList.value.length - 1\r\n        }\r\n        handleScroll()\r\n    }\r\n}\r\nfunction keyDown() {\r\n    if (resultList.value.length) {\r\n        actived.value += 1\r\n        if (actived.value > resultList.value.length - 1) {\r\n            actived.value = 0\r\n        }\r\n        handleScroll()\r\n    }\r\n}\r\nfunction keyEnter() {\r\n    if (actived.value !== -1) {\r\n        proxy.$refs[`search-item-${actived.value}`][0].click()\r\n    }\r\n}\r\nfunction handleScroll() {\r\n    let scrollTo = 0\r\n    if (actived.value !== -1) {\r\n        scrollTo = proxy.$refs['search'].scrollTop\r\n        const activedOffsetTop = proxy.$refs[`search-item-${actived.value}`][0].offsetTop\r\n        const activedClientHeight = proxy.$refs[`search-item-${actived.value}`][0].clientHeight\r\n        const searchScrollTop = proxy.$refs['search'].scrollTop\r\n        const searchClientHeight = proxy.$refs['search'].clientHeight\r\n        if (activedOffsetTop + activedClientHeight > searchScrollTop + searchClientHeight) {\r\n            scrollTo = activedOffsetTop + activedClientHeight - searchClientHeight\r\n        } else if (activedOffsetTop <= searchScrollTop) {\r\n            scrollTo = activedOffsetTop\r\n        }\r\n    }\r\n    proxy.$refs['search'].scrollTo({\r\n        top: scrollTo\r\n    })\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div id=\"search\" :class=\"{'searching': isShow}\" @click=\"isShow && $eventBus.emit('global-search-toggle')\">\r\n        <div class=\"container\">\r\n            <div class=\"search-box\" @click.stop>\r\n                <el-input ref=\"input\" v-model=\"searchInput\" placeholder=\"搜索页面，支持标题、URL模糊查询\" clearable @keydown.esc=\"$eventBus.emit('global-search-toggle')\" @keydown.up.prevent=\"keyUp\" @keydown.down.prevent=\"keyDown\" @keydown.enter.prevent=\"keyEnter\">\r\n                    <template #prefix>\r\n                        <el-icon>\r\n                            <svg-icon name=\"ep:search\" />\r\n                        </el-icon>\r\n                    </template>\r\n                </el-input>\r\n                <div v-if=\"settingsStore.mode === 'pc'\" class=\"tips\">\r\n                    <div class=\"tip\">\r\n                        <span>Alt</span>+<span>S</span>\r\n                        唤醒搜索面板\r\n                    </div>\r\n                    <div class=\"tip\">\r\n                        <span>\r\n                            <el-icon>\r\n                                <svg-icon name=\"search-up\" />\r\n                            </el-icon>\r\n                        </span>\r\n                        <span>\r\n                            <el-icon>\r\n                                <svg-icon name=\"search-down\" />\r\n                            </el-icon>\r\n                        </span>\r\n                        切换搜索结果\r\n                    </div>\r\n                    <div class=\"tip\">\r\n                        <span>\r\n                            <el-icon>\r\n                                <svg-icon name=\"search-enter\" />\r\n                            </el-icon>\r\n                        </span>\r\n                        访问页面\r\n                    </div>\r\n                    <div class=\"tip\">\r\n                        <span>ESC</span>\r\n                        退出\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div ref=\"search\" class=\"result\" :class=\"{'mobile': settingsStore.mode === 'mobile'}\">\r\n                <router-link v-for=\"(item, index) in resultList\" :key=\"item.path\" v-slot=\"{ href, navigate }\" custom :to=\"isShow ? item.path : ''\">\r\n                    <a :ref=\"`search-item-${index}`\" :href=\"isExternalLink(item.path) ? item.path : href\" class=\"item\" :class=\"{'actived': index === actived}\" :target=\"isExternalLink(item.path) ? '_blank' : '_self'\" @click=\"navigate\" @mouseover=\"actived = index\">\r\n                        <el-icon class=\"icon\">\r\n                            <svg-icon v-if=\"item.icon\" :name=\"item.icon\" />\r\n                        </el-icon>\r\n                        <div class=\"info\">\r\n                            <div class=\"title\">\r\n                                {{ item.title }}\r\n                            </div>\r\n                            <div class=\"breadcrumb\">\r\n                                <span v-for=\"(bc, bcIndex) in item.breadcrumb\" :key=\"bcIndex\">\r\n                                    {{ bc }}\r\n                                    <el-icon>\r\n                                        <svg-icon name=\"ep:arrow-right\" />\r\n                                    </el-icon>\r\n                                </span>\r\n                            </div>\r\n                            <div class=\"path\">{{ item.path }}</div>\r\n                        </div>\r\n                    </a>\r\n                </router-link>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n#search {\r\n    position: fixed;\r\n    z-index: 2000;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: var(--el-overlay-color-lighter);\r\n    backdrop-filter: blur(10px);\r\n    transition: all 0.2s;\r\n    transform: translateZ(0);\r\n    opacity: 0;\r\n    visibility: hidden;\r\n    &.searching {\r\n        opacity: 1;\r\n        visibility: visible;\r\n        .container {\r\n            transform: initial;\r\n            filter: initial;\r\n        }\r\n    }\r\n    .container {\r\n        display: flex;\r\n        flex-direction: column;\r\n        max-width: 800px;\r\n        height: 100%;\r\n        margin: 0 auto;\r\n        transition: all 0.2s;\r\n        transform: scale(1.1);\r\n        filter: blur(10px);\r\n        .search-box {\r\n            margin: 50px 20px 40px;\r\n            :deep(.el-input__inner) {\r\n                height: 52px;\r\n                line-height: 52px;\r\n            }\r\n            :deep(.el-input__icon) {\r\n                height: 100%;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n            }\r\n            .tips {\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: space-evenly;\r\n                margin-top: 20px;\r\n                line-height: 24px;\r\n                font-size: 14px;\r\n                color: #fff;\r\n                span {\r\n                    margin: 0 5px;\r\n                    padding: 3px 8px 5px;\r\n                    border-radius: 5px;\r\n                    font-size: 12px;\r\n                    font-weight: bold;\r\n                    color: var(--el-text-color-primary);\r\n                    background-color: var(--el-fill-color);\r\n                    box-shadow: inset 0 -2px var(--el-fill-color-lighter), inset 0 0 1px 1px var(--el-fill-color-darker);\r\n                }\r\n            }\r\n        }\r\n        .result {\r\n            position: relative;\r\n            margin: 0 20px;\r\n            max-height: calc(100% - 250px);\r\n            border-radius: 5px;\r\n            overflow: auto;\r\n            background-color: var(--el-bg-color);\r\n            box-shadow: 0 0 0 1px var(--el-border-color-darker);\r\n            &.mobile {\r\n                max-height: calc(100% - 200px);\r\n            }\r\n            .item {\r\n                display: flex;\r\n                align-items: center;\r\n                text-decoration: none;\r\n                cursor: pointer;\r\n                transition: all 0.3s;\r\n                &.actived {\r\n                    background-color: var(--el-bg-color-page);\r\n                    .icon {\r\n                        color: var(--el-color-primary);\r\n                        transform: scale(1.2);\r\n                    }\r\n                    .info {\r\n                        border-left-color: var(--el-border-color);\r\n                        .title {\r\n                            color: var(--el-text-color-primary);\r\n                        }\r\n                        .breadcrumb,\r\n                        .path {\r\n                            color: var(--el-text-color-regular);\r\n                        }\r\n                    }\r\n                }\r\n                .icon {\r\n                    flex: 0 0 66px;\r\n                    text-align: center;\r\n                    color: var(--el-color-info);\r\n                    font-size: 20px;\r\n                    transition: all 0.3s;\r\n                }\r\n                .info {\r\n                    flex: 1;\r\n                    height: 70px;\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    justify-content: space-around;\r\n                    border-left: 1px solid var(--el-border-color-lighter);\r\n                    padding: 5px 10px 7px;\r\n                    transition: all 0.3s;\r\n                    @include text-overflow(1, true);\r\n                    .title {\r\n                        font-size: 18px;\r\n                        font-weight: bold;\r\n                        color: var(--el-text-color-regular);\r\n                        @include text-overflow(1, true);\r\n                    }\r\n                    .breadcrumb,\r\n                    .path {\r\n                        font-size: 12px;\r\n                        color: var(--el-text-color-secondary);\r\n                        transition: all 0.3s;\r\n                        @include text-overflow(1, true);\r\n                    }\r\n                    .breadcrumb {\r\n                        span {\r\n                            margin-right: 5px;\r\n                            &:last-child i {\r\n                                display: none;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"names":["proxy","getCurrentInstance","settingsStore","useSettingsStore","routeStore","useRouteStore","menuStore","useMenuStore","isShow","ref","searchInput","sourceList","actived","resultList","computed","result","value","filter","item","flag","title","indexOf","path","breadcrumb","some","b","getSourceList","arr","map","meta","sidebar","children","every","i","hasChildren","baseBreadcrumb","deepClone","push","child","c","baseIcon","icon","basePath","join","isExternalLink","i18n","keyUp","length","handleScroll","keyDown","keyEnter","$refs","click","scrollTo","scrollTop","activedOffsetTop","offsetTop","activedClientHeight","clientHeight","searchScrollTop","searchClientHeight","top","watch","val","document","querySelector","classList","add","search","$hotkeys","setTimeout","input","focus","remove","unbind","onMounted","$eventBus","on","e","topbar","enableNavSearch","preventDefault","app","routeBaseOn","routes","menus"],"mappings":"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"}