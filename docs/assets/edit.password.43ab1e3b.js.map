{"version":3,"file":"edit.password.43ab1e3b.js","sources":["../../src/components/FixedActionBar/index.vue","../../src/views/personal/edit.password.vue"],"sourcesContent":["<script setup name=\"FixedActionBar\">\r\nconst data = ref({\r\n    isBottom: true\r\n})\r\n\r\nonMounted(() => {\r\n    onScroll()\r\n    window.addEventListener('scroll', onScroll)\r\n})\r\n\r\nonUnmounted(() => {\r\n    window.removeEventListener('scroll', onScroll)\r\n})\r\n\r\nfunction onScroll() {\r\n    // 变量scrollTop是滚动条滚动时，滚动条上端距离顶部的距离\r\n    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop\r\n    // 变量windowHeight是可视区的高度\r\n    var windowHeight = document.documentElement.clientHeight || document.body.clientHeight\r\n    // 变量scrollHeight是滚动条的总高度（当前可滚动的页面的总高度）\r\n    var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight\r\n    // 滚动条到底部\r\n    if (Math.ceil(scrollTop + windowHeight) >= scrollHeight) {\r\n        data.value.isBottom = true\r\n    } else {\r\n        data.value.isBottom = false\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"actionbar\" :class=\"{'shadow': !data.isBottom}\" data-fixed-calc-width>\r\n        <slot />\r\n    </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.actionbar {\r\n    z-index: 4;\r\n    bottom: 0;\r\n    padding: 20px;\r\n    text-align: center;\r\n    background-color: var(--g-app-bg);\r\n    box-shadow: 0 0 1px 0 var(--g-box-shadow-color);\r\n    transition: all 0.3s, var(--el-transition-box-shadow);\r\n    &.shadow {\r\n        box-shadow: 0 -10px 10px -10px var(--g-box-shadow-color);\r\n    }\r\n}\r\n:deep(.el-form-item) {\r\n    margin-bottom: 0;\r\n}\r\n</style>\r\n","<route>\r\n{\r\n    meta: {\r\n        title: \"修改密码\",\r\n        parentTitle: \"个人信息\",\r\n        parentIcon: \"config\"\r\n    }\r\n}\r\n</route>\r\n\r\n<script setup name=\"PersonalEditPassword\">\r\nconst route = useRoute(), router = useRouter()\r\nconst { proxy } = getCurrentInstance()\r\n\r\nimport useUserStore from '@/store/modules/user'\r\nconst userStore = useUserStore()\r\n\r\nconst validatePassword = (rule, value, callback) => {\r\n    if (value !== form.value.newpassword) {\r\n        callback(new Error('请确认新密码'))\r\n    } else {\r\n        callback()\r\n    }\r\n}\r\n\r\nconst form = ref({\r\n    password: '',\r\n    newpassword: '',\r\n    checkpassword: ''\r\n})\r\n\r\nconst rules = ref({\r\n    password: [\r\n        { required: true, message: '请输入原密码', trigger: 'blur' }\r\n    ],\r\n    newpassword: [\r\n        { required: true, message: '请输入新密码', trigger: 'blur' },\r\n        { min: 6, max: 18, trigger: 'blur', message: '密码长度为6到18位' }\r\n    ],\r\n    checkpassword: [\r\n        { required: true, message: '请输入新密码', trigger: 'blur' },\r\n        { validator: validatePassword }\r\n    ]\r\n})\r\n\r\nfunction onSubmit() {\r\n    proxy.$refs['formRef'].validate(valid => {\r\n        if (valid) {\r\n            userStore.editPassword(form.value).then(() => {\r\n                ElMessage({\r\n                    type: 'success',\r\n                    message: '模拟修改成功，请重新登录'\r\n                })\r\n                userStore.logout().then(() => {\r\n                    router.push({\r\n                        name: 'login',\r\n                        query: {\r\n                            redirect: route.fullPath\r\n                        }\r\n                    })\r\n                })\r\n            }).catch(() => {})\r\n        }\r\n    })\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n        <page-header title=\"修改密码\" content=\"定期修改密码可以提高帐号安全性噢~\" />\r\n        <page-main>\r\n            <el-row>\r\n                <el-col :md=\"24\" :lg=\"12\">\r\n                    <el-form ref=\"formRef\" :model=\"form\" :rules=\"rules\" label-width=\"120px\">\r\n                        <el-form-item label=\"原密码\" prop=\"password\">\r\n                            <el-input v-model=\"form.password\" type=\"password\" placeholder=\"请输入原密码\" />\r\n                        </el-form-item>\r\n                        <el-form-item label=\"新密码\" prop=\"newpassword\">\r\n                            <el-input v-model=\"form.newpassword\" type=\"password\" placeholder=\"请输入原密码\" />\r\n                        </el-form-item>\r\n                        <el-form-item label=\"确认新密码\" prop=\"checkpassword\">\r\n                            <el-input v-model=\"form.checkpassword\" type=\"password\" placeholder=\"请输入原密码\" />\r\n                        </el-form-item>\r\n                    </el-form>\r\n                </el-col>\r\n            </el-row>\r\n        </page-main>\r\n        <fixed-action-bar>\r\n            <el-button type=\"primary\" size=\"large\" @click=\"onSubmit\">提交</el-button>\r\n        </fixed-action-bar>\r\n    </div>\r\n</template>\r\n"],"names":["data","ref","isBottom","onScroll","scrollTop","document","documentElement","body","windowHeight","clientHeight","scrollHeight","Math","ceil","value","onMounted","window","addEventListener","onUnmounted","removeEventListener","route","useRoute","router","useRouter","proxy","getCurrentInstance","userStore","useUserStore","form","password","newpassword","checkpassword","rules","required","message","trigger","min","max","validator","rule","callback","Error","onSubmit","$refs","validate","valid","editPassword","then","ElMessage","type","logout","push","name","query","redirect","fullPath","catch"],"mappings":"opBACA,MAAAA,EAAAC,EAAA,CACAC,UAAA,IAYA,SAAAC,IAEA,IAAAC,EAAAC,SAAAC,gBAAAF,WAAAC,SAAAE,KAAAH,UAEAI,EAAAH,SAAAC,gBAAAG,cAAAJ,SAAAE,KAAAE,aAEAC,EAAAL,SAAAC,gBAAAI,cAAAL,SAAAE,KAAAG,aAEAC,KAAAC,KAAAR,EAAAI,IAAAE,EACAV,EAAAa,MAAAX,UAAA,EAEAF,EAAAa,MAAAX,UAAA,SApBAY,GAAA,KACAX,IACAY,OAAAC,iBAAA,SAAAb,MAGAc,GAAA,KACAF,OAAAG,oBAAA,SAAAf,uQCAA,MAAAgB,EAAAC,IAAAC,EAAAC,KACAC,MAAAA,GAAAC,IAGAC,EAAAC,IAUAC,EAAA1B,EAAA,CACA2B,SAAA,GACAC,YAAA,GACAC,cAAA,KAGAC,EAAA9B,EAAA,CACA2B,SAAA,CACA,CAAAI,UAAA,EAAAC,QAAA,SAAAC,QAAA,SAEAL,YAAA,CACA,CAAAG,UAAA,EAAAC,QAAA,SAAAC,QAAA,QACA,CAAAC,IAAA,EAAAC,IAAA,GAAAF,QAAA,OAAAD,QAAA,eAEAH,cAAA,CACA,CAAAE,UAAA,EAAAC,QAAA,SAAAC,QAAA,QACA,CAAAG,UAxBA,CAAAC,EAAAzB,EAAA0B,KACA1B,IAAAc,EAAAd,MAAAgB,YACAU,EAAA,IAAAC,MAAA,WAEAD,SAwBA,SAAAE,IACAlB,EAAAmB,MAAA,QAAAC,UAAAC,IACAA,GACAnB,EAAAoB,aAAAlB,EAAAd,OAAAiC,MAAA,KACAC,EAAA,CACAC,KAAA,UACAf,QAAA,iBAEAR,EAAAwB,SAAAH,MAAA,KACAzB,EAAA6B,KAAA,CACAC,KAAA,QACAC,MAAA,CACAC,SAAAlC,EAAAmC,kBAIAC,OAAA"}